<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="newChatInterface.title">新聊天界面 (复刻 Dify)</title>
    
    <!-- Favicon -->
    <link rel="icon" href="/Variant=Black, Lockup=Logomark.png" type="image/png">
    
    <!-- AWS Amplify V5 兼容性脚本 -->
    <script>
        window.global = window;
        window.process = { env: {} };
        var exports = {};
    </script>

    <!-- Amplify 配置 -->
    <script type="module" src="/scripts/amplify-config.js"></script>

    <!-- 载入翻译文件 -->
    <script>document.documentElement.classList.add('i18n-loading');</script>
    <script src="/locales/zh-CN.js"></script>
    <script src="/locales/zh-TW.js"></script>
    <script src="/locales/en.js"></script>

    <!-- 引入Marked库用于Markdown渲染 (聊天内容可能需要) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- 通用样式 -->
    <link rel="stylesheet" href="/styles/common.css">
    <!-- 新聊天界面特定样式 -->
    <link rel="stylesheet" href="/styles/new-chat-interface.css">
     <!-- 引入 Dify Markdown 样式 (可选, 如果要精确复刻) -->
    <link rel="stylesheet" href="/styles/markdown.css"> 
    
    <!-- 字体 (与 Homepage.html 保持一致) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Microsoft+YaHei:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 基础字体设置 (确保应用) */
        html[lang="en"] body, html[lang="en"] * { font-family: 'Inter', Verdana, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important; }
        html[lang="zh-CN"] body, html[lang="zh-TW"] body, html[lang="zh-CN"] *, html[lang="zh-TW"] * { font-family: "Microsoft YaHei", "微软雅黑", 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif !important; }
        
        /* 确保 body 高度填充 */
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        
        /* 主聊天容器占满剩余空间 */
        .dify-chat-container {
            flex-grow: 1; /* 让聊天容器填充剩余垂直空间 */
            display: flex; /* 使用 flex 布局 */
            overflow: hidden; /* 防止内部元素溢出 */
            background-color: #f9fafb; /* Dify 常用背景色 */
        }
    </style>

    <!-- 引入并初始化 Header 模块 -->
    <script type="module" src="/modules/common/header.js"></script>

</head>
<body>
    <!-- 通过 modules/common/header.js 渲染头部 -->
    <div id="header-container"></div>

    <!-- 移动端侧边栏切换按钮 -->
    <div class="sidebar-toggle" id="sidebar-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </div>

    <!-- Dify 风格聊天界面主容器 (占满剩余高度) -->
    <div class="dify-chat-container" id="dify-chat-container">
        <!-- 侧边栏 -->
        <div class="dify-sidebar" id="dify-sidebar">
            <!-- "New Chat" 按钮区域 -->
            <div class="new-chat-button-container">
                <button class="new-chat-button">
                    <!-- 内联 SVG 铅笔图标 -->
                    <svg class="icon pencil-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                    </svg>
                    <span data-translate="newChatInterface.newChat">新对话</span>
                </button>
            </div>
    
            <!-- 会话历史列表 -->
            <nav class="chat-history-nav" id="chat-history-nav">
                <!-- 示例会话 1 (选中状态) -->
                <div class="chat-history-item active">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    数据分析和可视化
                </div>
                <!-- 示例会话 2 -->
                <div class="chat-history-item">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    投资组合优化模型
                </div>
                <!-- 示例会话 3 -->
                <div class="chat-history-item">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    风险评估建议
                </div>
                <!-- 示例会话 4 -->
                <div class="chat-history-item">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    市场趋势分析报告
                </div>
            </nav>
    
            <!-- 版权信息 (可选) -->
            <div class="sidebar-footer">
                <div class="copyright-text">
                    &copy; 2024 EVYD Powered by Dify
                </div>
            </div>
        </div>

        <!-- 主聊天区域 -->
        <div class="dify-main-chat-area" id="dify-main-chat-area">
            <!-- 消息显示区域 -->
            <div class="chat-messages-list" id="chat-messages-list">
                <!-- 示例：机器人消息 -->
                <div class="message bot-message">
                    <div class="message-avatar bot-avatar">
                        <!-- 内联 SVG 机器人图标 -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                             <path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><path d="M9 13v2"></path>
                        </svg>
                    </div>
                    <div class="message-content-wrapper">
                        <div class="message-content">
                            <p>您好，我是 EVYD 智能助手。我可以帮助您分析数据、解答金融问题以及提供投资建议。</p>
                            <p>您今天想要了解什么？</p>
                        </div>
                        <!-- 消息操作按钮 -->
                        <div class="message-actions">
                            <!-- 复制按钮 -->
                            <button class="action-button copy-button" title="复制">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </button>
                            <!-- 点赞按钮 -->
                            <button class="action-button like-button" title="赞">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                </svg>
                            </button>
                            <!-- 踩按钮 -->
                            <button class="action-button dislike-button" title="踩">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm10-13h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-3"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
        
                <!-- 示例：用户消息 -->
                <div class="message user-message">
                    <div class="message-avatar user-avatar">
                        <!-- 内联 SVG 用户图标 -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                     <div class="message-content-wrapper">
                        <div class="message-content">
                            <p>我想了解一下 EVYD 的投资组合优化功能，它如何帮助我平衡风险和收益？</p>
                        </div>
                    </div>
                </div>
                <!-- More messages would be added dynamically -->
            </div>
        
            <!-- 输入区域 -->
            <div class="chat-input-area" id="chat-input-area">
                <div class="input-inner-container">
                    <textarea 
                        class="message-input" 
                        id="message-input" 
                        placeholder="输入您的问题..."
                        rows="1"></textarea>
        
                    <div class="input-controls">
                        <span class="char-count" id="char-count">0/4000</span>
                        <button class="send-button" id="send-button" disabled>
                            <!-- 内联 SVG 发送图标 -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
                 <!-- Optional: Loading indicator placeholder -->
                <div class="loading-indicator" id="loading-indicator" style="display: none;">
                    <span>处理中...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 简单的交互脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 侧边栏切换
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebar = document.getElementById('dify-sidebar');
            
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });
            }

            // 侧边栏选择
            const historyItems = document.querySelectorAll('.chat-history-item');
            historyItems.forEach(item => {
                item.addEventListener('click', function() {
                    // 移除所有选中状态
                    historyItems.forEach(i => i.classList.remove('active'));
                    // 添加当前选中状态
                    this.classList.add('active');
                });
            });

            // 字符计数
            const messageInput = document.getElementById('message-input');
            const charCount = document.getElementById('char-count');
            const sendButton = document.getElementById('send-button');
            
            if (messageInput && charCount && sendButton) {
                messageInput.addEventListener('input', function() {
                    const count = this.value.length;
                    charCount.textContent = `${count}/4000`;
                    
                    // 启用或禁用发送按钮
                    sendButton.disabled = count === 0;
                    
                    // 自动调整高度
                    this.style.height = 'auto';
                    const newHeight = Math.min(this.scrollHeight, 150);
                    this.style.height = newHeight + 'px';
                });
            }
        });
    </script>
</body>
</html> 